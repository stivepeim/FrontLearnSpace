<!DOCTYPE HTML>
<html>
<head>
    <style>
    section{
        width:450px;
    }
    canvas {                                            /* ??????? */
        border: 2px solid #007d9a;
        float: left;
        border-radius: 5px;                             /* ?????? */
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        margin-right:10px;
        margin-top:5px;
    }
    @-webkit-keyframes bluePulse {                      /* ??????????? */
		  from { background-color: #007d9a; -webkit-box-shadow: 0 0 9px #333; }
		  50% { background-color: #2daebf; -webkit-box-shadow: 0 0 18px #2daebf; }
		  to { background-color: #007d9a; -webkit-box-shadow: 0 0 9px #333; }
	}
    .button {                                           /* ????????? */
        background-color: #2DAEBF;
        padding: 8px 19px 9px;
        color: #fff;
        font-size: 14px;
        font-weight: bold;
        text-decoration: none;
        border-radius: 5px;                             /* ?????? */
        -moz-border-radius: 5px;
        -webkit-border-radius: 5px;
        -moz-box-shadow: 0 1px 3px rgba(0,0,0,0.25);
        -webkit-box-shadow: 0 1px 3px rgba(0,0,0,0.25);
        text-shadow: 0 -1px 1px rgba(0,0,0,0.25);
        border-bottom: 1px solid rgba(0,0,0,0.25);
        -webkit-animation-name: bluePulse;              /* ?????????????? */    
        -webkit-animation-duration: 2s;                 /* ?????????? */
        -webkit-animation-iteration-count: infinite;
        cursor: pointer;
        width : 215px;
     }
    .button:hover {                                     /* ?????????? */
        background-color: #007d9a;
    }
    .clip{                                              /* ????????? */
        border:2px dashed #007d9a;
        position: absolute;
    }
    </style>
</head>
<body>
    <header><h2>?????????????</h2></header>
    <section>
        <!-- ???????? -->
        <input type="file" class="button"/>
        <!-- ????? -->
        <canvas id="J_canvas_i" width="250" height="300"></canvas>
        <!-- ????? -->
        <canvas id="J_canvas_ii" width="150" height="200"></canvas>
    </section>
</body>
<script>
    var canvas_i = document.getElementById('J_canvas_i'),       // ???Canvas???????
        context_i = canvas_i.getContext("2d"),                  // ???Canvas?????????
        canvas_ii = document.getElementById('J_canvas_ii'),     // ??????Canvas???????
        context_ii = canvas_ii.getContext("2d"),                // ??????Canvas?????????
        input_file = document.querySelector('input[type=file]'),// ?????????
        clip_wraper = document.createElement('div'),            // ??????????????
        img = new Image();                                      // ???????????
    var myimg = new Image();
    myimg.src = "http://api.map.baidu.com/staticimage?width=700&height=480&center=120.2511,30.4255&zoom=9&markers=119.956183,30.014993|119.974581,29.972954&markerStyles=l,1|l,2";
    context_i.drawImage(myimg,0,0);
    clip_wraper.setAttribute('class', 'clip');                  // ????????????
    function draw() {                                           // ?????????
        // ???????????????????????
        context_i.clearRect(0, 0, parseInt(canvas_i.width), parseInt(canvas_i.height));
        // ???????????????????????
        context_ii.clearRect(0, 0, parseInt(canvas_ii.width), parseInt(canvas_ii.height));
        context_i.drawImage(img, 0, 0);                         // ???????????
    };
    //?????????????????????????1????????????2?????????????????????????????????????
    function css(element, options) {
        if (typeof options === 'string') {
            return element.style[options];
        } else {
            for (var name in options) {
                element.style[name] = options[name];
            };
        }
    };
    img.addEventListener('load', draw, false);                  // ?????????????????
    input_file.addEventListener('change', function () {         // ?????????????
        var files = this.files,                                 // ?????????
            reader;
        for (var i = 0, length = files.length; i < length; i++) {
            if (files[i].type.toLowerCase().match(/image.*/)) { // ????????????????????????
                reader = new FileReader();                      // ?????FileReader?????????????????
                reader.addEventListener('load', function (e) {  // ????FileReader?????load???
                    img.src = e.target.result;                  // ??????????
                });
                reader.readAsDataURL(files[i]);                 // ?????????dataURI???
                break;
            };
        };
    }, false);
    var start_x = 0, start_y = 0,                               // ???????XY?????????
        move_x = 0, move_y = 0,                                 // ??????????????????
        offset_xy = 6;                                          // ?????????????????
    function canvas_mousemove(e) {                              // ?????????????
        // ????????????????????????????????????????
        move_x = e.clientX - start_x;
        move_y = e.clientY - start_y;
        if (move_x > 0 && move_y > 0) {                         // ??????????????
            css(clip_wraper, {
                'width': move_x + 'px',
                'height': move_y + 'px',
                'top': (start_y - offset_xy) + 'px',
                'left': (start_x - offset_xy) + 'px'
            });
        } else if (move_x > 0 && move_y < 0) {                  // ?????????????
            css(clip_wraper, {
                'width': move_x + 'px',
                'height': Math.abs(move_y) + 'px',
                'top': (e.clientY + offset_xy) + 'px'
            });
        } else if (move_x < 0 && move_y > 0) {                  // ?????????????
            css(clip_wraper, {
                'width': Math.abs(move_x) + 'px',
                'height': move_y + 'px',
                'left': (e.clientX + offset_xy) + 'px'
            });
        } else if (move_x < 0 && move_y < 0) {                  // ?????????????
            css(clip_wraper, {
                'width': Math.abs(move_x) + 'px',
                'height': Math.abs(move_y) + 'px',
                'left': e.clientX + 'px',
                'top': (e.clientY + offset_xy) + 'px'
            });
        };
    };
    // ???????????????????
    clip_wraper.addEventListener('mousemove', canvas_mousemove, false);
    // ?????????????????
    canvas_i.addEventListener('mousedown', function (e) {
        css(clip_wraper, {
            // ???????????????????????????????????????????????
            'left': (start_x = (e.clientX - offset_xy)) + 'px',
            'top': (start_y = (e.clientY - offset_xy)) + 'px',
            'width': '1px',
            'height': '1px'
        });
        document.body.appendChild(clip_wraper);                 // ????????????DOM?????
        // ????????????????????????canvas_mousemove????
        canvas_i.addEventListener('mousemove', canvas_mousemove, false);
    }, false);
    document.addEventListener('mouseup', function (e) {         // ???????DOM??????????;
        // ???????????????????
        canvas_i.removeEventListener('mousemove', canvas_mousemove, false);
        if (e.target.nodeName.toLowerCase() == 'canvas' &&
            move_x > offset_xy &&                              // ??????????????????????
            move_y > offset_xy &&
            img.src.length > 0                                 // ??????????????
            ) {
            var sourceX = parseInt(css(clip_wraper, 'left')) - canvas_i.offsetLeft,
                sourceY = parseInt(css(clip_wraper, 'top')) - canvas_i.offsetTop,
                destWidth = parseInt(canvas_ii.width),
                destHeight = parseInt(canvas_ii.height);
            context_ii.clearRect(0, 0, destWidth, destHeight);// ????????????
            // ???????????
            context_ii.drawImage(img, sourceX, sourceY, Math.abs(move_x), Math.abs(move_y), 0, 0, destWidth, destHeight);
            console.info(canvas_ii.toDataURL("image/png"));
        };
        // ??DOM??????????????
        try { document.body.removeChild(clip_wraper); } catch (e) { };
    }, false);
    // ???????????????????????????????????????????
    document.addEventListener('selectstart', function (e) { e.preventDefault() }, false);
</script>
</html>