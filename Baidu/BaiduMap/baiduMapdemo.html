<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="content-type" content="text/html;charset=utf-8"/>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <title>异步加载百度地图</title>
    <style type="text/css">
        body, html, #map {
            width: 100%;
            height: 100%;
            overflow: hidden;
            margin: 0;
        }
    </style>
    <script src="../../Jquery/jquery.min.js"></script>
    <script type="text/javascript">


        function loadScript() {
            var script = document.createElement("script");
            script.src = "http://api.map.baidu.com/api?v=2.0&ak=RB0AVcDOavaCeC2xOaM0gvfKnwomgIuf&callback=initialize";//此为v2.0版本的引用方式
            script.type = "text/javascript";
            document.body.appendChild(script);
        }

        window.onload = loadScript;

        function initialize() {
//            var mp = new BMap.Map('map');
            var map = new BMap.Map('map', {enableMapClick: false});//默认关闭POI事件
            map.centerAndZoom(new BMap.Point(108.953133, 34.247262), 15);
            //创建多边形
            var polygon = new BMap.Polygon([
                new BMap.Point(108.934017, 34.247322),
                new BMap.Point(108.937682, 34.223267),
                new BMap.Point(108.965709, 34.220819),
                new BMap.Point(108.991365, 34.250903),
                new BMap.Point(108.953277, 34.254782)
            ], {strokeColor: "red", strokeWeight: 10, strokeOpacity: 0.5});  //创建多边形
            map.addOverlay(polygon);
            //增加标注点
            var point = new BMap.Point(108.953133, 34.247262);
            map.enableScrollWheelZoom();                 //启用滚轮放大缩小
            map.centerAndZoom(point, 15);

            //弹出窗口属性信息设置
            var opts = {
                width: 250,     // 信息窗口宽度
                height: 80,     // 信息窗口高度
                title: "信息窗口", // 信息窗口标题
                enableMessage: true//设置允许信息窗发送短息
            };
            // 解析json数据集添加marker
            $.getJSON("PointsData.json", function (points_json) {
                console.info("详细点数据：" + points_json.data);
                console.info("详细点数据：" + points_json.data);
                $.each(points_json.data, function (i, n) {
                    var item_point = points_json.data[i];
                    console.info("point_lat:" + item_point.lat + "|point_lng:" + item_point.lng);
                    var point = new BMap.Point(item_point.lat, item_point.lng);
                    addMarker(item_point.dic, point)
                });
            });
            // 编写自定义函数,创建标注
            function addMarker(dic, point) {
                var marker = new BMap.Marker(point);
                map.addOverlay(marker);
                marker.addEventListener("click", function (e) {
                        openInfo(dic, e)
                    }
                );
            }
            //点击标注后弹出信息框
            function openInfo(content, e) {
                var p = e.target;
                var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
                var infoWindow = new BMap.InfoWindow(content, opts);  // 创建信息窗口对象
                map.openInfoWindow(infoWindow, point); //开启信息窗口
            }
        }



    </script>

</head>
<body>
<div id="map"></div>
</body>
</html>
<script type="text/javascript">

</script>